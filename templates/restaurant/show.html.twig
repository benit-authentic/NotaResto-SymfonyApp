{% extends 'base.html.twig' %}

{% block title %}Détails du restaurant{% endblock %}

{% block body %}
    <div class="container mt-3">
        <div class="row">
            <div class="col-md-4">
                <h2>{{ restaurant.name }}</h2>
                <ul class="list-unstyled">
                    <li>
                        <strong>Localité:</strong> {{ restaurant.zipcode }} {{ restaurant.address }}
                    </li>
                    <li>
                        <strong>Note moyenne :</strong> {{ restaurant.averageRating | number_format(2, ',') }}
                    </li>
                </ul>
                <p>{{ restaurant.description }}</p>

                <div class="mb-3">
                    {% for picture in restaurant.restaurantPictures %}
                        <img src="{{ asset('uploads/pictures/' ~ picture.filename) }}" alt="" class="img-thumbnail mb-2" style="width: 100px; height: 100px;" data-toggle="modal" data-target="#picture-{{ picture.id }}">
                    {% endfor %}
                </div>
                <hr>
                {% if is_granted('ROLE_RESTAURATEUR') and app.user == restaurant.user %}
                    <h3>Ajouter une image</h3>
                    {{ form_start(formPicture) }}
                    <div class="form-group">
                        {{ form_widget(formPicture) }}
                    </div>
                    <button class="btn btn-primary">Envoyer</button>
                    {{ form_end(formPicture) }}
                {% endif %}
            </div>

            {% for picture in restaurant.restaurantPictures %}
                <!-- Modal -->
                <div class="modal fade" id="picture-{{ picture.id }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog mw-100 w-75" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <img src="{{ asset('uploads/pictures/' ~ picture.filename) }}" class="img-fluid">
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}

            <div class="col-md-8">
                <h2>Les avis sur ce restaurant</h2>
                <hr>
                <div class="card mb-3">
                    <div class="card-header">
                        Rédigez un avis sur ce restaurant !
                    </div>
                    <div class="card-body">
                        {{ form_start(formReview) }}
                        {{ form_widget(formReview) }}
                        <button class="btn btn-primary float-right">Envoyer</button>
                        {{ form_end(formReview) }}
                    </div>
                </div>

                {% for review in restaurant.reviews %}
                    <div class="card mb-2">
                        <h2>Les avis sur ce restaurant</h2>
                        <hr>
                        <div class="card-header">
                            Rédigé par {{ review.user.name }} ({{ review.rating }}/5)
                        </div>
                        <div class="card-body">
                            {{ review.message }}
                        </div>

                        {% if is_granted('ROLE_RESTAURATEUR') and app.user == restaurant.user %}
                            <div class="card-footer">
                                <form action="" method="post">
                                    <div class="form-group">
                                        <label for="response">Message</label>
                                        <input type="text" class="form-control" id="response" name="response" placeholder="Répondre à cet avis...">
                                    </div>
                                    <button class="btn btn-primary float-right" type="submit">Répondre</button>
                                </form>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}
